
# ZABBIX PHYSICAL LOGIN MONITORING
module(load="omfile")

template(name="ZabbixPhysical" type="list") {
    property(name="timestamp" dateFormat="rfc3339")
    constant(value=" ")
    property(name="hostname")
    constant(value=" ")
    property(name="msg" spifno1stsp="on")
    property(name="msg" droplastlf="on")
    constant(value="\n")
}

# Physical Login Rules
:programname, isequal, "login" {
    if $msg contains "FAILED LOGIN" or $msg contains "authentication failure" then {
        action(
            type="omfile"
            File="/var/log/zabbix-monitor/physical-login-failed.log"
            Template="ZabbixPhysical"
            FileOwner="root"
            FileGroup="zabbix"
            FileCreateMode="0640"
            CreateDirs="on"
            Sync="off"
            FlushOnTXEnd="on"
            IOBufferSize="64k"
            dynaFileCacheSize="0"
        )
        stop
    }
}

:programname, contains, "gdm" {
    if $msg contains "authentication failure" or $msg contains "pam_unix" then {
        action(
            type="omfile"
            File="/var/log/zabbix-monitor/physical-login-failed.log"
            Template="ZabbixPhysical"
            FileOwner="root"
            FileGroup="zabbix"
            FileCreateMode="0640"
            CreateDirs="on"
            Sync="off"
            FlushOnTXEnd="on"
            IOBufferSize="64k"
            dynaFileCacheSize="0"
        )
        stop
    }
}

if $msg contains "pam_unix" and $msg contains "authentication failure" and $msg contains "tty" then {
    action(
        type="omfile"
        File="/var/log/zabbix-monitor/physical-login-failed.log"
        Template="ZabbixPhysical"
        FileOwner="root"
        FileGroup="zabbix"
        FileCreateMode="0640"
        CreateDirs="on"
        Sync="off"
        FlushOnTXEnd="on"
        IOBufferSize="64k"
        dynaFileCacheSize="0"
    )
    stop
}
